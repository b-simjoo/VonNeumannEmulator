let diagram,editor,memory,state,interval,memBoxWidth=8,ops=["load","store","add","and","jump","jumpz","comp","lsl"],RTLs=[["T0: AR <- PC, PC <- PC+1","T1: IR <- Mem[AR]","Load.T2: AR <- IR[11:0]","Load.T3: DR <- Mem[AR]","Load.T4: AC <- DR, SC <- 0"],["T0: AR <- PC, PC <- PC+1","T1: IR <- Mem[AR]","Store.T2: AR <- IR[11:0]","Store.T3: Mem[AR] <- AC, SC <- 0"],["T0: AR <- PC, PC <- PC+1","T1: IR <- Mem[AR]","Add.T2: AR <- IR[11:0]","Add.T2: DR <- Mem[AR]","Add.T4: AC <- AC+DR, SC <- 0"],["T0: AR <- PC, PC <- PC+1","T1: IR <- Mem[AR]","And.T2: AR <- IR[11:0]","And.T3: DR <- Mem[AR]","And.T4: AC <- AC & DR, SC <- 0"],["T0: AR <- PC, PC <- PC+1","T1: IR <- Mem[AR]","Jump.T2: PC <- IR[11:0], SC <- 0"],["T0: AR <- PC, PC <- PC+1","T1: IR <- Mem[AR]","Jumpz.T2.z: PC <- IR[11:0], Jumpz.T2: SC <- 0"],["T0: AR <- PC, PC <- PC+1","T1: IR <- Mem[AR]","Comp.T3: AC <- ~AC, SC <- 0"],["T0: AR <- PC, PC <- PC+1","T1: IR <- Mem[AR]","LSL.T2: AC <- LSL(AC), SC <- 0"]],paramFunc=/^\s*(load|store|add|and|jump|jumpz)\s*(\d+)\s*(?:\/\/.*)?$/,noParamFunc=/^\s*(comp|lsl)\s*(?:\/\/.*)?$/,literal=/^\s*(\d+)\s*(?:\/\/.*)?$/,nothing=/^\s*(?:\/\/.*)?$/;function asmbler(e){let t=new Array(4096);for(let r=0;r<e.length;r++){let o=e[r],n=0;if(paramFunc.test(o)){let e=o.match(paramFunc);n=(ops.indexOf(e[1])<<12)+parseInt(e[2])}else if(noParamFunc.test(o)){let e=o.match(noParamFunc);n=ops.indexOf(e[1])<<12}else if(literal.test(o))n=parseInt(o.match(literal)[1]);else{if(!nothing.test(o))return[!1,r];n=0}t[r]=n}return[!0,t]}function ce(e,...t){let r;return"string"==typeof e?r=document.createElement(e):(r=document.createElement(e.tagName),r.classList.add(...e.cls)),t.forEach((e=>{"function"==typeof e?r.append(...e()):r.append(e)})),r}function renderMem(){return ce("table",(()=>{let e=[ce("tr",ce("th"," "),(()=>{let e=[];for(let t=0;t<memBoxWidth;t++)e.push(ce("th",HEX(t)));return e}))];for(let t=0;t<4095;t+=memBoxWidth)e.push(ce("tr",ce("td",HEX(t,3)),(()=>{let e=[];for(let r=0;r<memBoxWidth;r++)e.push(ce({tagName:"td",cls:diagram.Mem.memArray[t+r]?[]:["zero"]},HEX(diagram.Mem.memArray[t+r])));return e})));return e}))}function resetMem(){memory?.remove(),memory=renderMem(),document.getElementById("memory")?.append(memory),diagram.Mem.onArrayChange=(e,t,r)=>{let o=memory?.childNodes[Math.floor(t/memBoxWidth)+1]?.childNodes[t%memBoxWidth+1];o.classList.add("changed"),r?o.classList.remove("zero"):o.classList.add("zero"),o.innerText=HEX(r,4),setTimeout((()=>{o.classList.remove("changed")}),5e3)},state&&(state.innerText="Memory cleared, Click Compile to load program")}function compile(){let e=Array();editor?.childNodes.forEach((t=>{t.nodeType!==Node.TEXT_NODE&&("\n"!==t.innerText?e.push(t.innerText):e.push(""))}));let[t,r]=asmbler(e);return t?(diagram.loadMemArray(r),resetMem(),state&&(state.innerText="Ready. Click Run to start")):(console.error(`Error at line: ${r}`),state&&(state.innerText=`Error at line: ${r}`)),t}function tick(){diagram.tick(),diagram.tick(),state&&(state.innerText=RTLs[diagram.IncDec.output][diagram.SeqDec.output])}function run(){document.getElementById("pause").disabled=!1,tick(),interval=setTimeout((()=>{run()}),timeout)}function stop(){document.getElementById("pause").disabled=!0,clearTimeout(interval)}function next(){tick()}function reset(){stop(),diagram=new Diagram(diagram.diagramSVG),diagram.tick(),diagram.CLKup=!1,resetMem()}let timeout=1e3;window.onload=function(){console.clear();let e=document.getElementById("diagram")?.contentDocument;if(!e)throw new Error("Could not find diagram");if(diagram=new Diagram(e),editor=document.getElementById("editor"),!editor)throw new Error("Could not find editor");Editor(editor),editor?.focus(),compile(),state=document.getElementById("state");let t=document.getElementById("speed");if(t){timeout=11e3-t.valueAsNumber;let e=document.getElementById("freq");e&&(e.innerHTML=`${Math.round(1e6/timeout)} nHz`),console.log(`timeout: ${timeout}`),t.oninput=()=>{timeout=11e3-t.valueAsNumber;let e=document.getElementById("freq");e&&(e.innerHTML=`${Math.round(1e6/timeout)} nHz`),console.log(`timeout: ${timeout}`)}}};
//# sourceMappingURL=index.104d5ee2.js.map
